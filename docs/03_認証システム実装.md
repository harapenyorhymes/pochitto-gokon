# 03. 認証システム実装

## 概要
メール認証とLINEログイン機能を実装し、ユーザーの登録・ログイン機能を提供する。

## 作業内容

### Supabase認証設定
- [x] Supabase Authの基本設定
- [x] メール認証の有効化
- [ ] LINE Login プロバイダーの設定（次フェーズ）
- [x] 認証フローの確認

### 認証ページ実装
- [x] ログインページ (app/login/page.tsx)
- [x] サインアップページ (app/signup/page.tsx)
- [x] 認証状態管理 (lib/auth.ts)
- [x] 認証ガードコンポーネント (components/AuthGuard.tsx)

### LINE Login実装
- [x] LINE Loginのスコープ設定（`openid profile email`）とコンセント文言の確定
- [x] LINE Login SDK（またはOAuthフロー）の初期化ロジック実装
- [x] ログインページへのLINEログインボタン実装（UI/UX含む）
- [x] 認証コールバックルートの実装（CSRF/State検証・エラーハンドリング）
- [x] LINEプロフィール/メールアドレスの取得とSupabaseユーザー保存
- [x] プロフィール入力画面への遷移フロー統合（既存メール登録と共通化）

### 設定共有メモ（LINE Login）
- [ ] `.env.local` に `NEXT_PUBLIC_LINE_LOGIN_CHANNEL_ID` と `LINE_LOGIN_CHANNEL_SECRET` を設定（本番値はSecrets Managerで管理）
- [ ] LINE Developers にローカル用（`http://localhost:3000/api/auth/callback/line`）と本番用のコールバックURLを登録
- [ ] Supabase Auth ProviderでLINE Loginを有効化し、Channel ID/SecretとリダイレクトURLを設定（担当者と共有）
- [ ] プロフィール入力画面でLINE取得情報（表示名・メール）の初期値反映を確認

### 認証フロー
- [x] 新規ユーザー登録フロー
- [x] 既存ユーザーログインフロー
- [x] ログアウト機能
- [x] 認証状態の永続化

### ユーザー体験
- [x] ローディング状態の表示
- [x] エラーハンドリング
- [x] 認証後のリダイレクト処理
- [x] 未認証ユーザーのページアクセス制御

## 完了条件
- メール認証での新規登録・ログインが可能
- LINEログインが正常に動作する
- 認証状態が適切に管理されている
- 未認証ユーザーが保護されたページにアクセスできない
- エラーケースが適切にハンドリングされている

## 注意事項
- LINEログイン時のスコープ設定に注意
- セキュリティを考慮した認証フローの実装
- ユーザーエクスペリエンスを損なわないエラーメッセージの表示
